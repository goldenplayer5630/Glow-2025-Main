<!-- Flower.App/Views/MainView.axaml -->
<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ac="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls"
    xmlns:vm="clr-namespace:Flower.App.ViewModels"
    xmlns:models="clr-namespace:Flower.Core.Models;assembly=Flower.Core"
    xmlns:conv="clr-namespace:Flower.App.Utilities;assembly=Flower.App"
    xmlns:util="clr-namespace:Flower.App.Utilities;assembly=Flower.App"
    x:Class="Flower.App.Views.MainView"
    x:DataType="vm:AppViewModel">

  <!-- Tablet-friendly styles -->
  <UserControl.Styles>
      <!-- Play = green -->
        <Style Selector="Button.play">
          <Setter Property="Background" Value="#179A00"/>
          <Setter Property="Foreground" Value="White"/>
          <Setter Property="BorderBrush" Value="#0F6A00"/>
        </Style>
        <Style Selector="Button.play:pointerover">
          <Setter Property="Background" Value="#1FB000"/>
        </Style>
        <Style Selector="Button.play:pressed">
          <Setter Property="Background" Value="#168600"/>
        </Style>
        <Style Selector="Button.play:disabled">
          <Setter Property="Opacity" Value="0.6"/>
        </Style>

        <!-- Stop = red -->
        <Style Selector="Button.stop">
          <Setter Property="Background" Value="#C62828"/>
          <Setter Property="Foreground" Value="White"/>
          <Setter Property="BorderBrush" Value="#8E1E1E"/>
        </Style>
        <Style Selector="Button.stop:pointerover">
          <Setter Property="Background" Value="#D32F2F"/>
        </Style>
        <Style Selector="Button.stop:pressed">
          <Setter Property="Background" Value="#B71C1C"/>
        </Style>
        <Style Selector="Button.stop:disabled">
          <Setter Property="Opacity" Value="0.6"/>
        </Style>

        <!-- Emergency Stop = super red -->
        <Style Selector="Button.estop">
          <Setter Property="Background" Value="#C62828"/>
          <Setter Property="Foreground" Value="White"/>
          <Setter Property="BorderBrush" Value="#8E1E1E"/>
          <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        <Style Selector="Button.stop:pointerover">
          <Setter Property="Background" Value="#D32F2F"/>
        </Style>
        <Style Selector="Button.stop:pressed">
          <Setter Property="Background" Value="#B71C1C"/>
        </Style>
        <Style Selector="Button.stop:disabled">
          <Setter Property="Opacity" Value="0.6"/>
        </Style>

        <Style Selector="Button.estop:pointerover">
          <Setter Property="Background" Value="#F44336"/>
        </Style>

        <Style Selector="Button.estop:pressed">
          <Setter Property="Background" Value="#C62828"/>
        </Style>



    <!-- Buttons -->
    <Style Selector="Button">
      <Setter Property="FontSize" Value="18"/>
      <Setter Property="MinHeight" Value="56"/>
      <Setter Property="MinWidth" Value="140"/>
      <Setter Property="Padding" Value="16,10"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
    </Style>



    <!-- ComboBox -->
    <Style Selector="ComboBox">
      <Setter Property="FontSize" Value="18"/>
      <Setter Property="MinHeight" Value="48"/>
      <Setter Property="Padding" Value="12,8"/>
      <Setter Property="MinWidth" Value="220"/>
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
    </Style>

    <!-- List items -->
    <Style Selector="ListBoxItem">
      <Setter Property="MinHeight" Value="44"/>
      <Setter Property="Padding" Value="8,6"/>
      <Setter Property="FontSize" Value="16"/>
    </Style>

    <Style Selector="TextBlock.header">
      <Setter Property="FontSize" Value="18"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
    </Style>

      <!-- Emergency Stop = super red -->
  </UserControl.Styles>

    <UserControl.Resources>
        <conv:ConnectionStatusToBrushConverter x:Key="StatusBrush" />
    </UserControl.Resources>


  <!-- Layout: top serial, middle 3-cols (show | monitor | flowers), bottom status -->
  <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="1.0*,1.0*,2.0*">
    <!-- ===== Row 0: Show (left) + Monitor (right) close together ===== -->
    <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
            ColumnDefinitions="160,8,*">
        <!-- Show buttons (left) -->
    <!-- Show buttons (left) -->
    <Border Grid.Column="0" Padding="12" Classes="card">
      <StackPanel Spacing="12">
        <Button Content="Manage Buses" FontSize="14" Command="{Binding OpenManageBusesCommand}"/>
        <Button Content="Creator" Command="{Binding OpenShowCreatorCommand}"/>
        <Button Content="Load Show" Command="{Binding LoadShowCommand}"/>
        <Button Content="Play Show" Command="{Binding PlayCommand}" Classes="play"/>
        <Button Content="Stop Show" Command="{Binding StopCommand}" Classes="stop"/>
      </StackPanel>
    </Border>


        <!-- 8px spacer is the middle column -->

        <!-- Monitor (right) -->
        <Border Grid.Column="2" Padding="12" Classes="card">
          <TextBox Text="{Binding MonitorText}"
                   AcceptsReturn="True"
                   IsReadOnly="True"
                   FontSize="12"
                   ScrollViewer.VerticalScrollBarVisibility="Auto"
                   util:AutoScrollBehavior.AutoScrollToEnd="True"/>
        </Border>

    </Grid>


    <!-- ===== Row 0, Col 2: Flowers panel ===== -->
    <Border Grid.Row="1" Grid.Column="2" Padding="12" Classes="card">
      <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header + actions in 3x2 grid -->
        <Grid RowDefinitions="Auto,*,Auto">
          <!-- Header + actions in 3x2 grid -->
          <Grid Margin="0,0,0,12"
                ColumnDefinitions="*,*,*,*"
                RowDefinitions="Auto,Auto,Auto">
            <!--- Row 0 -->
            <Button Grid.Row="0" Content="EMERGENCY STOP"
                Grid.ColumnSpan="4"
                FontSize="14"
                                Command="{Binding EmergencyStopCommand}"
                Width="250"
                Classes="estop"
                Margin="0,0,12,12"
                ac:ToolTip.Tip="Immediately stop show and turn off all LEDs via broadcast" />
            <!-- Row 1 -->
            <Button Grid.Row="1" Grid.Column="0"
                    Content="Assign Bus"
                    FontSize="16"
                    Command="{Binding AssignBusesCommand}"
                    IsEnabled="{Binding CanAssignBuses}"
                    Margin="0,0,12,12"/>

                <Button Grid.Row="1" Grid.Column="1"
                    Content="Disconnect All"
                    Command="{Binding DisconnectAllFlowersCommand}"
                    FontSize="16"
                    Margin="0,0,12,12"/>

                <Button Grid.Row="1" Grid.Column="2"
                    Content="Connect All"
                    Command="{Binding ConnectAllFlowersCommand}"
                    Margin="0,0,12,12"/>

          <StackPanel Grid.Row="1" Grid.Column="3">
          <Button Content="Connect"
                    IsVisible="{Binding DisabledConnect}"
                    IsEnabled="False"/>
            <Button Content="Connect"
                    Command="{Binding ConnectFlowerCommand}"
                    IsVisible="{Binding CanConnect}" />
            <Button Content="Disconnect"
                    Command="{Binding DisconnectFlowerCommand}"
                    IsVisible="{Binding CanDisconnect}" />
            <Button Content="Reconnect"
                    Command="{Binding ReconnectFlowerCommand}"
                    IsVisible="{Binding CanReconnect}" />
          </StackPanel>


            <!-- Row 2 -->
            <Button Grid.Row="2" Grid.Column="0"
                    Content="Send Cmd"
                    Command="{Binding SendCommandToFlowerCommand}"
                    IsEnabled="{Binding CanSendCommand}"
                    Margin="0,0,0,0"/>
            <Button Grid.Row="2" Grid.Column="1"
                    Content="Add"
                    Command="{Binding AddFlowerCommand}"
                    Margin="0,0,12,0"/>

            <Button Grid.Row="2" Grid.Column="2"
                    Content="Update"
                    Command="{Binding UpdateFlowerCommand}"
                    Margin="0,0,12,0"/>

            <Button Grid.Row="2" Grid.Column="3"
                    Content="Delete"
                    Command="{Binding DeleteSelectedFlowerCommand}"
                    Margin="0,0,0,0"/>

          </Grid>
        </Grid>
        <!-- List -->
        <ListBox Grid.Row="1"
                 ItemsSource="{Binding Flowers}"
                 SelectedItem="{Binding SelectedFlower, Mode=TwoWay}">
          <ListBox.ItemTemplate>
            <DataTemplate x:DataType="models:FlowerUnit">
              <!-- 6 columns now: "Id:", Id, Category, FlowerStatus, ConnDot, Brightness -->
              <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto,Auto,Auto,Auto,Auto,Auto" Margin="0,6">
                <CheckBox
                  IsChecked="{Binding AssignSelected}"/>

                <TextBlock Grid.Column="1"
                           Text="{Binding Id}"
                           Width="52"
                           TextAlignment="Center"
                           VerticalAlignment="Center"/>

                <TextBlock Grid.Column="2"
                           Text="{Binding Category}"
                           VerticalAlignment="Center"/>

                <TextBlock Text="Prio" 
                           Margin="0,0,8,0"
                           Grid.Column="4"
                           HorizontalAlignment="Right" 
                           VerticalAlignment="Center"/>

                <TextBlock Text="{Binding Priority}" 
                           Margin="0,0,8,0"
                           Grid.Column="5"
                           HorizontalAlignment="Right" 
                           VerticalAlignment="Center"/>

                <TextBlock Grid.Column="6"
                           Text="{Binding BusId}"
                           HorizontalAlignment="Right"
                           Margin="16,0,0,0"
                           VerticalAlignment="Center"/>

                <TextBlock Grid.Column="7"
                           Text="{Binding FlowerStatus}"
                           HorizontalAlignment="Right"
                           Margin="16,0,0,0"
                           VerticalAlignment="Center"/>

                <!-- Connection status as a colored dot -->
                <Ellipse Grid.Column="8"
                         Width="12" Height="12"
                         HorizontalAlignment="Right"
                         Margin="16,0,16,0"
                         VerticalAlignment="Center">
                  <Ellipse.Fill>
                    <SolidColorBrush Color="{Binding ConnectionStatus, Converter={StaticResource StatusBrush}, ConverterParameter={x:Null}}"/>
                  </Ellipse.Fill>
                  <ac:ToolTip.Tip>
                    <TextBlock Text="{Binding ConnectionStatus}"/>
                  </ac:ToolTip.Tip>
                </Ellipse>

                <Grid Grid.Column="9"
                      ColumnDefinitions="Auto,Auto"
                      HorizontalAlignment="Right"
                      VerticalAlignment="Center">
                  <TextBlock Grid.Column="0"
                             Text="{Binding CurrentBrightness}"
                             Width="32"
                             TextAlignment="Center"
                             VerticalAlignment="Center"/>
                  <TextBlock Grid.Column="1"
                             Text="&#xE706;"
                             FontFamily="Segoe MDL2 Assets"
                             VerticalAlignment="Center"/>
                </Grid>
              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </Grid>
    </Border>

    <!-- ===== Row 2: Status (bottom-left) ===== -->
    <TextBlock Grid.Row="2" Grid.Column="0"
               Text="{Binding StatusText}"
               FontSize="16"
               HorizontalAlignment="Left"
               VerticalAlignment="Center"
               Margin="0,8,0,0"
               Opacity="0.75" />
  </Grid>
</UserControl>
